"use strict";(self.webpackChunksynaptask_docs=self.webpackChunksynaptask_docs||[]).push([[428],{8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var s=t(6540);const i={},c=s.createContext(i);function r(e){const n=s.useContext(c);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(c.Provider,{value:n},e.children)}},8596:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"api/ws/connect","title":"WebSocket Coonnect","description":"Purpose: Establish an authenticated Socket.IO session.","source":"@site/docs/api/ws/connect.md","sourceDirName":"api/ws","slug":"/api/ws/ws_connect","permalink":"/api/ws/ws_connect","draft":false,"unlisted":false,"editUrl":"https://github.com/arsenlblack/synaptask/edit/main/docs/api/ws/connect.md","tags":[],"version":"current","lastUpdatedBy":"admin","lastUpdatedAt":1757823755000,"frontMatter":{"title":"WebSocket Coonnect","slug":"/api/ws/ws_connect"},"sidebar":"tutorialSidebar","previous":{"title":"Authentication","permalink":"/api/authentication"},"next":{"title":"graph:get","permalink":"/guides/share-access"}}');var i=t(4848),c=t(8453);const r={title:"WebSocket Coonnect",slug:"/api/ws/ws_connect"},o=void 0,l={},d=[{value:"Authentication",id:"authentication",level:2},{value:"Rate Limits",id:"rate-limits",level:2},{value:"Origin Policy (Web only)",id:"origin-policy-web-only",level:2},{value:"Server \u2192 Client Events",id:"server--client-events",level:2},{value:"<code>connected</code>",id:"connected",level:3},{value:"Client \u2192 Server",id:"client--server",level:2},{value:"Security Notes",id:"security-notes",level:2},{value:"Error Codes",id:"error-codes",level:2}];function a(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Establish an authenticated Socket.IO session."]}),"\n",(0,i.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsxs)(n.p,{children:["When connecting with Socket.IO, provide the API token in the ",(0,i.jsx)(n.code,{children:"auth"})," payload:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const socket = io(SERVER_URL, {\n  transports: ['websocket'],\n  auth: { api_token: '<api_token>' }\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:"Or send as a header if your client supports it:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Sec-WebSocket-Protocol: Bearer, st_xxxxxxxxxxxxxxxxxxxx\n"})}),"\n",(0,i.jsx)(n.h2,{id:"rate-limits",children:"Rate Limits"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Per IP:"})," ",(0,i.jsx)(n.code,{children:"10 / 60s"})," (bucketed)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Per User (connect attempts):"})," ",(0,i.jsx)(n.code,{children:"20 / 60s"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Concurrent connections per user:"})," ",(0,i.jsx)(n.code,{children:"10"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"origin-policy-web-only",children:"Origin Policy (Web only)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Prod:"})," only ",(0,i.jsx)(n.code,{children:"synaptask.space"})," is allowed."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"server--client-events",children:"Server \u2192 Client Events"}),"\n",(0,i.jsx)(n.h3,{id:"connected",children:(0,i.jsx)(n.code,{children:"connected"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "ok": true,\n  "uid": "uuid",\n  "client": "web|api",\n  "serverTime": "2025-09-13T10:00:00Z"\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"client--server",children:"Client \u2192 Server"}),"\n",(0,i.jsxs)(n.p,{children:["API clients must explicitly request data after the handshake (e.g., ",(0,i.jsx)(n.code,{children:"graph:get"}),")."]}),"\n",(0,i.jsx)(n.h2,{id:"security-notes",children:"Security Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Dual throttling (IP & user) + cap on concurrent SIDs per user."}),"\n",(0,i.jsx)(n.li,{children:"No payload is pushed on connect for API clients."}),"\n",(0,i.jsxs)(n.li,{children:["Disconnect cleanup removes ",(0,i.jsx)(n.code,{children:"sid"})," from both ",(0,i.jsx)(n.code,{children:"WS_SID2UID"})," and ",(0,i.jsx)(n.code,{children:"WS_UID2SIDS:{uid}"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"error-codes",children:"Error Codes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Connection rejected (rate limit): transport error ",(0,i.jsx)(n.code,{children:"io server disconnect"})," (client should retry with backoff)."]}),"\n",(0,i.jsx)(n.li,{children:"Connection rejected (origin/auth): same as above; log contains reason on server."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);