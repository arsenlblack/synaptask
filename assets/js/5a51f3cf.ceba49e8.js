"use strict";(self.webpackChunksynaptask_docs=self.webpackChunksynaptask_docs||[]).push([[733],{6824:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"api/ws/link_add","title":"link:add","description":"Create a link between two nodes via WebSocket.","source":"@site/docs/api/ws/link_add.md","sourceDirName":"api/ws","slug":"/api/ws/link_add","permalink":"/api/ws/link_add","draft":false,"unlisted":false,"editUrl":"https://github.com/arsenlblack/synaptask/edit/main/docs/api/ws/link_add.md","tags":[],"version":"current","lastUpdatedBy":"admin","lastUpdatedAt":1758847208000,"frontMatter":{"title":"link:add","slug":"/api/ws/link_add"},"sidebar":"tutorialSidebar","previous":{"title":"node:add","permalink":"/api/ws/node_add"},"next":{"title":"GET /api/graph","permalink":"/api/rest/get_graph"}}');var r=i(4848),d=i(8453);const t={title:"link:add",slug:"/api/ws/link_add"},c=void 0,l={},a=[{value:"Behavior",id:"behavior",level:2},{value:"Rate Limits",id:"rate-limits",level:2},{value:"Client \u2192 Server (<code>link:add</code>)",id:"client--server-linkadd",level:3},{value:"Success (ack)",id:"success-ack",level:4},{value:"Broadcasting (<code>graph:diff</code>)",id:"broadcasting-graphdiff",level:3},{value:"Error (ack)",id:"error-ack",level:4},{value:"Example (JavaScript)",id:"example-javascript",level:2},{value:"Example (Python)",id:"example-python",level:2}];function o(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Create a link between two nodes via WebSocket."}),"\n",(0,r.jsx)(n.h2,{id:"behavior",children:"Behavior"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A link represents a dependency between nodes."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"type"}),":","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"0"})," \u2192 primary link (blocking): source blocks target."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"1"})," \u2192 secondary link (non-blocking)."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["ACL:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["For ",(0,r.jsx)(n.strong,{children:"secondary links"}),", caller must have at least ",(0,r.jsx)(n.strong,{children:"editor"})," access to source and ",(0,r.jsx)(n.strong,{children:"viewer"})," access to target."]}),"\n",(0,r.jsxs)(n.li,{children:["For ",(0,r.jsx)(n.strong,{children:"primary links"}),", caller must must have at least ",(0,r.jsx)(n.strong,{children:"editor"})," access on both."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"History batch records link creation and all side effects (e.g., cascading blocking of ancestors)."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"rate-limits",children:"Rate Limits"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"5 / 10s"})," per user."]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"client--server-linkadd",children:["Client \u2192 Server (",(0,r.jsx)(n.code,{children:"link:add"}),")"]}),"\n",(0,r.jsx)(n.p,{children:"Request to create a link between nodes."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "source": "uuid",\n  "target": "uuid",\n  "type": 0\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"source"})," \u2014 ID of the source node (string, required)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"target"})," \u2014 ID of the target node (string, required)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"type"})," \u2014 integer: ",(0,r.jsx)(n.code,{children:"0 = primary"})," (blocking), ",(0,r.jsx)(n.code,{children:"1 = secondary"})," (optional)"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"success-ack",children:"Success (ack)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "ok": true,\n  "diff": {\n    "links": [\n      {\n        "id": "uuid",\n        "source": "nodeId",\n        "target": "nodeId",\n        "type": 0,\n        "wasBlocker": true,\n        "version": 0\n      }\n    ],\n    "nodes": [\n      {\n        "id": "uuid",\n        "status": 2,\n        "version": 5\n      }\n    ]\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"links"})," \u2014 the created or updated link(s)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"nodes"})," \u2014 any nodes affected by cascade blocking (if primary link)."]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"broadcasting-graphdiff",children:["Broadcasting (",(0,r.jsx)(n.code,{children:"graph:diff"}),")"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"This event is sent to other clients in the ACL room. The own client receives the ACK directly and is excluded for this event."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"error-ack",children:"Error (ack)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "ok": false,\n  "error": "forbidden" | "internal" | "not_found"\n       | "bad_request" | "conflict" | "rate_limited"\n  "message": "<optional human-readable>",\n  "trace_id": "abcd1234efgh"\n}\n'})}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Error Code"}),(0,r.jsx)(n.th,{children:"Meaning"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"bad_request.invalid_uuid"})}),(0,r.jsx)(n.td,{children:"Source/target is not a valid UUID"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"bad_request.missing_params"})}),(0,r.jsx)(n.td,{children:"Source or target missing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"forbidden.auth_missing"})}),(0,r.jsx)(n.td,{children:"No token/auth provided"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"forbidden"})}),(0,r.jsx)(n.td,{children:"ACL denied"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"not_found"})}),(0,r.jsx)(n.td,{children:"Source or target node does not exist"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"conflict"})}),(0,r.jsx)(n.td,{children:"Duplicate ID or version conflict"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"rate_limited"})}),(0,r.jsx)(n.td,{children:"Too many requests (rate limit exceeded)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"internal.exception"})}),(0,r.jsx)(n.td,{children:"Unexpected server error"})]})]})]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Each error can be specified by code (",(0,r.jsx)(n.code,{children:"namespace.reason"}),")."]})}),"\n",(0,r.jsx)(n.h2,{id:"example-javascript",children:"Example (JavaScript)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'// Create a primary link between nodes\nsocket.emit("link:add", { source: "123", target: "456", type: 0 }, (ack) => {\nif (ack.ok) {\nconsole.log("Link created:", ack.diff.links);\n} else {\nconsole.error("Link creation failed:", ack.error, ack.message);\n}\n});\n\n// Listen for broadcasts\nsocket.on("graph:diff", (diff) => {\nconsole.log("Graph updated:", diff);\n});\n\n'})}),"\n",(0,r.jsx)(n.h2,{id:"example-python",children:"Example (Python)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import socketio\n\n\nAPI_URL = "https://synaptask.space"\nAPI_TOKEN = "<YOUR_API_TOKEN>"\n\n\nsio = socketio.Client()\n\n\n@sio.event\ndef connect():\nprint("connected:", sio.sid)\nsio.emit("link:add", {"source": "123", "target": "456", "type": 0}, callback=on_link_ack)\n\n\ndef on_link_ack(ack):\nif ack.get("ok"):\nprint("Link created:", ack["diff"]["links"])\nelse:\nprint("Link creation failed:", ack["error"], ack.get("message"))\nsio.disconnect()\n\n\nsio.connect(API_URL, auth={"api_token": API_TOKEN}, transports=["websocket"])\nsio.wait()\n'})}),"\n",(0,r.jsxs)(n.p,{children:["See also: ",(0,r.jsx)(n.a,{href:"../rest/add_link.md",children:"REST /api/link"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>c});var s=i(6540);const r={},d=s.createContext(r);function t(e){const n=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);