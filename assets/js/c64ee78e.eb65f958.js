"use strict";(self.webpackChunksynaptask_docs=self.webpackChunksynaptask_docs||[]).push([[428],{8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var s=t(6540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},8596:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"api/ws/connect","title":"WebSocket Connect","description":"Purpose: Establish an authenticated Socket.IO session.","source":"@site/docs/api/ws/connect.md","sourceDirName":"api/ws","slug":"/api/ws/ws_connect","permalink":"/api/ws/ws_connect","draft":false,"unlisted":false,"editUrl":"https://github.com/arsenlblack/synaptask/edit/main/docs/api/ws/connect.md","tags":[],"version":"current","lastUpdatedBy":"admin","lastUpdatedAt":1758847208000,"frontMatter":{"title":"WebSocket Connect","slug":"/api/ws/ws_connect"},"sidebar":"tutorialSidebar","previous":{"title":"Authentication","permalink":"/api/authentication"},"next":{"title":"graph:get","permalink":"/api/ws/get_graph"}}');var i=t(4848),r=t(8453);const o={title:"WebSocket Connect",slug:"/api/ws/ws_connect"},c=void 0,a={},l=[{value:"Authentication",id:"authentication",level:2},{value:"Python example",id:"python-example",level:3},{value:"Rate Limits",id:"rate-limits",level:2},{value:"Origin Policy (Web only)",id:"origin-policy-web-only",level:2},{value:"Server \u2192 Client Events",id:"server--client-events",level:2},{value:"Event: &quot;connected&quot;",id:"event-connected",level:3},{value:"<code>graph:diff</code> (broadcasting event)",id:"graphdiff-broadcasting-event",level:3},{value:"Client \u2192 Server",id:"client--server",level:2},{value:"Security Notes",id:"security-notes",level:2},{value:"Error Codes",id:"error-codes",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Purpose:"})," Establish an authenticated Socket.IO session."]}),"\n",(0,i.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsxs)(n.p,{children:["Provide an API token in the ",(0,i.jsx)(n.code,{children:"Authorization"})," header when establishing the WebSocket connection:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const socket = io(SERVER_URL, {\n  transports: ['websocket'],\n  extraHeaders: {\n    Authorization: 'Bearer <api_token>'\n  }\n});\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["All API WebSocket connections require a valid Bearer token in the ",(0,i.jsx)(n.code,{children:"Authorization"})," header"]})}),"\n",(0,i.jsx)(n.h3,{id:"python-example",children:"Python example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import socketio\n\nsio = socketio.Client()\n\nsio.connect(\n    "https://synaptask.space",\n    headers={"Authorization": "Bearer <api_token>"},\n    transports=["websocket"]\n)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"rate-limits",children:"Rate Limits"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Per IP:"})," ",(0,i.jsx)(n.code,{children:"10 / 60s"})," (bucketed)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Per User (connect attempts):"})," ",(0,i.jsx)(n.code,{children:"20 / 60s"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Concurrent connections per user:"})," ",(0,i.jsx)(n.code,{children:"10"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"origin-policy-web-only",children:"Origin Policy (Web only)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Prod:"})," only ",(0,i.jsx)(n.code,{children:"synaptask.space"})," is allowed."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"server--client-events",children:"Server \u2192 Client Events"}),"\n",(0,i.jsx)(n.h3,{id:"event-connected",children:'Event: "connected"'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "ok": true,\n  "uid": "uuid", // user id (RFC 4122 UUID v4 string)\n  "client": "web|api",\n  "serverTime": "2025-09-13T10:00:00Z" // RFC 3339 / UTC\n}\n'})}),"\n",(0,i.jsxs)(n.h3,{id:"graphdiff-broadcasting-event",children:[(0,i.jsx)(n.code,{children:"graph:diff"})," (broadcasting event)"]}),"\n",(0,i.jsx)(n.p,{children:"This event broadcasts any changes in nodes and links accessible to the client.\nPartial node or link objects may be sent; only changed fields are guaranteed."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "nodes": [\n    {\n      "id": "uuid",\n      "title": "string",\n      "description": "string",\n      "status": 2,\n      "dueDate": "2025-09-13T10:00:00Z",\n      "tags": ["backend", "urgent"],\n      "priority": 5,\n      "dependant": true,\n      "volume": 5,\n      "assignee": [],\n      "lastEditedTime": "2025-09-13T10:00:00Z",\n      "version": 3,\n      "shareRoots": ["uuid1", "uuid2"]\n    },\n    { \n      "id": "uuid",\n      "status": 2\n    }\n  ],\n  "links": [\n    {\n      "id": "uuid",\n      "type": 0,\n      "wasBlocker": true,\n      "version": 7\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"client--server",children:"Client \u2192 Server"}),"\n",(0,i.jsxs)(n.p,{children:["On successful connect, the server emits ",(0,i.jsx)(n.code,{children:"connected"}),". No graph data is sent automatically \u2014 clients must request it explicitly via ",(0,i.jsx)(n.code,{children:"graph:get"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"security-notes",children:"Security Notes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Dual throttling (IP & user) + cap on concurrent session ids per user."}),"\n",(0,i.jsx)(n.li,{children:"No payload is pushed on connect for API clients."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"error-codes",children:"Error Codes"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Connection rejected (rate limit): client receives a ",(0,i.jsx)(n.code,{children:"disconnect"})," event with reason ",(0,i.jsx)(n.code,{children:'"io server disconnect"'})," (should retry with backoff)."]}),"\n",(0,i.jsx)(n.li,{children:"Connection rejected (origin/auth): same as above; log contains reason on server."}),"\n",(0,i.jsx)(n.li,{children:"Unauthorized: before disconnect, server emits:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{"ok": false, "error": "forbidden.auth_missing", "message": "Authentication required"}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["See also: ",(0,i.jsxs)(n.a,{href:"/api/ws/get_graph",children:["graph",":get"]}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);