"use strict";(self.webpackChunksynaptask_docs=self.webpackChunksynaptask_docs||[]).push([[280],{3069:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"api/ws/node_add","title":"node:add","description":"Create a new node via WebSocket event. Equivalent to POST /api/node in REST.","source":"@site/docs/api/ws/node_add.md","sourceDirName":"api/ws","slug":"/api/ws/node_add","permalink":"/api/ws/node_add","draft":false,"unlisted":false,"editUrl":"https://github.com/arsenlblack/synaptask/edit/main/docs/api/ws/node_add.md","tags":[],"version":"current","lastUpdatedBy":"admin","lastUpdatedAt":1758847208000,"frontMatter":{"title":"node:add","slug":"/api/ws/node_add"},"sidebar":"tutorialSidebar","previous":{"title":"graph:get","permalink":"/api/ws/get_graph"},"next":{"title":"link:add","permalink":"/api/ws/link_add"}}');var d=i(4848),r=i(8453);const t={title:"node:add",slug:"/api/ws/node_add"},o=void 0,a={},c=[{value:"Visibility &amp; Permissions",id:"visibility--permissions",level:2},{value:"Client \u2192 Server <code>node:add</code>",id:"client--server-nodeadd",level:3},{value:"Success (ack)",id:"success-ack",level:3},{value:"Broadcasting (<code>graph:diff</code>)",id:"broadcasting-graphdiff",level:3},{value:"Error (ack)",id:"error-ack",level:3},{value:"Examples",id:"examples",level:2},{value:"JavaScript",id:"javascript",level:3},{value:"Python (socketio-client)",id:"python-socketio-client",level:3}];function l(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(n.p,{children:["Create a new node via WebSocket event. Equivalent to ",(0,d.jsx)(n.code,{children:"POST /api/node"})," in REST."]}),"\n",(0,d.jsx)(n.h2,{id:"visibility--permissions",children:"Visibility & Permissions"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Requires ",(0,d.jsx)(n.strong,{children:"authenticated user"})," (",(0,d.jsx)(n.code,{children:"socket_auth_required"}),")."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["If a ",(0,d.jsx)(n.code,{children:"target"})," (parent node) is provided:"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["User must have ",(0,d.jsx)(n.strong,{children:"editor"})," access on the parent."]}),"\n",(0,d.jsxs)(n.li,{children:["New node ",(0,d.jsx)(n.strong,{children:"inherits"})," the owner and ACL from the parent node."]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"viewer"})," or ",(0,d.jsx)(n.code,{children:"no access"})," \u2192 ",(0,d.jsx)(n.code,{children:"forbidden"})," error."]}),"\n"]}),"\n",(0,d.jsx)(n.blockquote,{children:"\n"}),"\n",(0,d.jsxs)(n.admonition,{type:"info",children:[(0,d.jsxs)(n.p,{children:["You can create a ",(0,d.jsx)(n.strong,{children:"stand-alone node"})," (without specifying ",(0,d.jsx)(n.code,{children:"target"}),")",(0,d.jsx)(n.br,{}),"\n","and later attach it to a read-only branch using ",(0,d.jsx)(n.a,{href:"./link_add",children:(0,d.jsx)(n.code,{children:"POST /api/link"})}),"."]}),(0,d.jsx)(n.p,{children:"In this case:"}),(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:'"source"'})," \u2192 your new node\u2019s ",(0,d.jsx)(n.code,{children:"id"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:'"target"'})," \u2192 the read-only node\u2019s ",(0,d.jsx)(n.code,{children:"id"}),","]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:'"type": 1'})," \u2192 secondary link (keeps your graph consistent without changing branch ACLs)."]}),"\n"]}),(0,d.jsxs)(n.p,{children:["This way, ",(0,d.jsx)(n.strong,{children:"you remain the owner"})," of the new node, while still preserving graph consistency and task dependencies."]})]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["If no ",(0,d.jsx)(n.code,{children:"target"})," is provided, node is created ",(0,d.jsx)(n.strong,{children:"stand-alone"})," under the caller\u2019s ownership."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["A primary link (type=0) is created if the parent is ",(0,d.jsx)(n.code,{children:"dependant=true"}),", otherwise a secondary link (type=1)."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"History batch records node creation, the link (if any) and all side effects like blocking parent (if any)."}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.h3,{id:"client--server-nodeadd",children:["Client \u2192 Server ",(0,d.jsx)(n.code,{children:"node:add"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:'{\n  "target": "<uuid>",     // optional parent node id\n  "title": "string",\n  "description": "string",\n  "status": 0,\n  "dueDate": "2025-09-13T10:00:00Z",\n  "tags": ["backend", "urgent"],\n  "priority": 5,\n  "dependant": true,\n  "volume": 5,\n  "assignee": ["user1", "user2"],\n  "pinned": false,\n  "collapsed": false\n}\n'})}),"\n",(0,d.jsx)(n.h3,{id:"success-ack",children:"Success (ack)"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:'{\n  "ok": true,\n  "diff": {\n    "nodes": [\n      {\n        "id": "uuid",\n        "title": "string",\n        "description": "string",\n        "status": 0,\n        "dueDate": "2025-09-13T10:00:00Z",\n        "tags": ["backend", "urgent"],\n        "priority": 5,\n        "dependant": true,\n        "volume": 5,\n        "assignee": [],\n        "pinned": false,\n        "collapsed": false,\n        "createdTime": "2025-09-13T10:00:00Z",\n        "lastEditedTime": "2025-09-13T10:00:00Z",\n        "version": 0,\n        "shareRoots": ["uuid1", "uuid2"]\n      },\n      { // blocked target (parent node / supertask)\n        "id": "uuid",\n        "status": 2,  // Partial snapshot: includes only fields changed as a result of the operation\n      }\n    ],\n    "links": [\n      {\n        "id": "uuid",\n        "source": "nodeId",\n        "target": "nodeId",\n        "type": 0,\n        "wasBlocker": false,\n        "version": 0\n      }\n    ]\n  }\n}\n'})}),"\n",(0,d.jsx)(n.admonition,{type:"info",children:(0,d.jsx)(n.p,{children:"The diff includes the newly created node (with all props). Existing nodes that were affected are also included with minimal snapshots (only changed fields).\nExisting nodes that were modified as a side effect (e.g., a parent being blocked) are also included, but only with the updated fields.\nEach diff may include existing nodes with partial updates (only changed fields). Consumers must merge by id+version, not overwrite blindly."})}),"\n",(0,d.jsxs)(n.h3,{id:"broadcasting-graphdiff",children:["Broadcasting (",(0,d.jsx)(n.code,{children:"graph:diff"}),")"]}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:"This event is sent to other clients in the ACL room. The own client receives the ACK directly and is excluded for this event."}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"error-ack",children:"Error (ack)"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-json",children:'{\n  "ok": false,\n  "error": "bad_request" | "forbidden" | "internal.exception",\n  "message": "<optional human-readable>"\n}\n'})}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Error"}),(0,d.jsx)(n.th,{children:"Meaning"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"bad_request"})}),(0,d.jsx)(n.td,{children:"Invalid payload"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"forbidden.auth_missing"})}),(0,d.jsx)(n.td,{children:"No token/auth header"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"forbidden"})}),(0,d.jsx)(n.td,{children:"ACL denied"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"not_found"})}),(0,d.jsx)(n.td,{children:"Target node doesn\u2019t exist"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"conflict"})}),(0,d.jsx)(n.td,{children:"Duplicate ID or version conflict"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"rate_limited"})}),(0,d.jsx)(n.td,{children:"Too many requests"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"internal.exception"})}),(0,d.jsx)(n.td,{children:"Unexpected server failure"})]})]})]}),"\n",(0,d.jsx)(n.admonition,{type:"info",children:(0,d.jsxs)(n.p,{children:["Each error can be specified by code (",(0,d.jsx)(n.code,{children:"namespace.reason"}),")."]})}),"\n",(0,d.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,d.jsx)(n.h3,{id:"javascript",children:"JavaScript"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-js",children:'socket.emit("node:add", payload, (resp) => {\n  if (resp.ok) {\n    console.log("Node created", resp.diff);\n  } else {\n    console.error("Node creation failed", resp.error);\n  }\n});\n'})}),"\n",(0,d.jsx)(n.h3,{id:"python-socketio-client",children:"Python (socketio-client)"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-python",children:'import socketio\nsio = socketio.Client()\n\nsio.connect("https://synaptask.space", headers={"Authorization": "Bearer <API_TOKEN>"})\nresp = sio.call("node:add", {"title": "Write WS docs", "priority": 3}, timeout=5)\nif resp.get("ok"):\n    print("Node created:", resp["diff"])\nelse:\n    print("Failed:", resp["error"])\n\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(l,{...e})}):l(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>o});var s=i(6540);const d={},r=s.createContext(d);function t(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:t(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);